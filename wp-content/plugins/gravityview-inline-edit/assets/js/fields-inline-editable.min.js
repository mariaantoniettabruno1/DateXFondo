!function(jQuery){"use strict";jQuery(document).ready(function($){var self={};self.init=function(){$.fn.editable.defaults.mode=gv_inline_x.mode,$.fn.editable.defaults.emptytext=gv_inline_x.emptytext,$.fn.editableform.buttons=gv_inline_x.buttons,$.fn.editableContainer.Inline.prototype.containerClass="gv-editable-container gform_wrapper editable-container editable-inline",$.fn.editableContainer.Popup.prototype.containerClass="gv-editable-container gform_wrapper editable-container editable-popup gv-editable-popover",$.fn.popover.Constructor.DEFAULTS.template='<div class="gv-editable-popover popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',$.fn.popover.Constructor.prototype.destroy=function(){var that=this;clearTimeout(this.timeout),this.hide(function(){null!=that.$element&&(that.$element.off("."+that.type).removeData("bs."+that.type),that.$tip&&that.$tip.detach(),that.$tip=null,that.$arrow=null,that.$viewport=null,that.$element=null)})},self.setInlineEditableFields(),self.setInlineEditableInitialState(),self.toggleInlineEdit(),self.initColumnToggle(),self.gfMoveToggleButton(),self.preventClicks()},self.getWPErrorMessage=function($wpError){for(var error in $wpError)if($wpError.hasOwnProperty(error))return $wpError[error][0]},self.updateFieldsOnEdit=function(updateResponse){$.isArray(updateResponse)&&$.each(updateResponse,function(i,response){if(response.selector&&response.data){var $selector=$(response.selector),value=response.value;try{value=JSON.parse(response.value)}catch(e){}$.each($selector,function(i,el){var $el=$(el),displayValue=response.data.display_value||"",entryLink=$el.attr("data-entry-link");$el.attr("data-show-map-link")&&response.data.map_link&&(displayValue+="<br>"+response.data.map_link),entryLink&&(displayValue=$("<a />",{href:entryLink,html:displayValue})),$el.attr("data-display",displayValue),"object"==typeof value&&$el.editable("setValue",value)})}})},self.convertDateFormat=function($GFdateFormat){var $formatName;switch($GFdateFormat){case"mdy":$formatName="mm/dd/yyyy";break;case"dmy":$formatName="dd/mm/yyyy";break;case"dmy_dash":$formatName="dd-mm-yyyy";break;case"dmy_dot":$formatName="dd.mm.yyyy";break;case"ymd_slash":$formatName="yyyy/mm/dd";break;case"ymd_dash":$formatName="yyyy-mm-dd";break;case"ymd_dot":$formatName="yyyy.mm.dd"}return $formatName},self.setInlineEditableFields=function(){$(".gv-inline-editable-view [class^=gv-inline-editable-field]").each(function(i,val){self.initializeEditableField($(this))})},self.initializeEditableField=function($field){var editableOptions,tplName,form_id=$field.data("formid"),field_id=$field.data("fieldid"),input_id=$field.data("inputid"),view_id=$field.data("viewid"),entry_id=$field.data("entryid"),field_type=$field.data("type");if(editableOptions={pk:entry_id,url:gv_inline_x.url,container:gv_inline_x.container,showbuttons:gv_inline_x.showbuttons,onblur:gv_inline_x.onblur,success:function(response){if(response&&response.errors)return self.getWPErrorMessage(response.errors);self.updateFieldsOnEdit(response)},display:null,savenochange:!0},$field.data("dateformat")&&(editableOptions.format="yyyy-mm-dd",editableOptions.viewformat=self.convertDateFormat($field.data("dateformat")),editableOptions.datepicker={firstDay:1,showOn:"focus"}),tplName=field_type,$field.data("tplmode")&&"address"!==field_type&&(tplName+=$field.data("tplmode")),gv_inline_x.templates.hasOwnProperty(tplName+"_"+form_id+"_"+field_id)){var template=gv_inline_x.templates[tplName+"_"+form_id+"_"+field_id],fieldValue=$field.attr("data-value"),fieldValueOther=$field.attr("data-other-choice")||"";"gf_other_choice"===fieldValue&&fieldValueOther.length&&(template=template.replace(/(_other.*?value=')(.*?)'/,"$1"+fieldValueOther+"'")),editableOptions.tpl=template}else gv_inline_x.templates.hasOwnProperty(tplName)&&(editableOptions.tpl=gv_inline_x.templates[tplName]);var singleModeDetails=self.getSingleFieldModeTemplate($field,field_type,editableOptions.tpl);if(singleModeDetails){if(singleModeDetails.disableField)return void $field.removeClass();editableOptions.tpl=singleModeDetails.tpl}editableOptions.params=function(fieldParms){var defaultParams={gv_inline_edit_field:"true",nonce:gv_inline_x.nonce,type:field_type,form_id:form_id,field_id:field_id,input_id:input_id,view_id:view_id};if(singleModeDetails&&(editableOptions.params.inputNumber=singleModeDetails.inputNumber),"radiolist"===field_type){var $input,popupId=$("#"+fieldParms.name).attr("aria-describedby");$input=popupId?$("#"+popupId).find("input:checked"):"forms_page_gf_entries"===window.pagenow?$(this).parents("td").find(".gv-editable-container input:checked"):$(this).next(".gv-editable-container").find("input:checked"),"gf_other_choice"===$input.val()?(fieldParms.value=$input.next().val(),$("#"+fieldParms.name).attr("data-other-choice",$input.next().val())):$("#"+fieldParms.name).removeAttr("data-other-choice")}return Object.assign({},defaultParams,fieldParms)},$field.editable(editableOptions),$field.data("maxLength")&&(editableOptions.params.maxlength=$field.data("maxLength")),"gvlist"===field_type&&$field.data("tplmode").match(/multi_/)&&($field.editable("option","multicolumn",!0),$field.editable("option","colcount",$field.data("colcount")),self.setGvListEmpty($field)),$field.on("shown",self.inlineEditFieldsOnShown)},self.inlineEditFieldsOnShown=function(e,editable){"inline"===editable.options.mode&&editable.container.$element.parents(".column-primary").length&&editable.container.$tip.insertBefore(editable.container.$element.parent()),"textarea"===editable.input.type&&editable.input.$input.attr("maxlength",editable.options.maxlength),"number"===editable.input.type&&editable.input.$input.attr("step","any")},self.setGvListEmpty=function($gvList){var gvListSourceData=$gvList.data("source");if(null!==gvListSourceData[0]&&"object"==typeof gvListSourceData[0]){0===$.map(gvListSourceData[0],function(val,index){if(val.length>0)return[val]}).length&&$gvList.editable("setValue","")}},self.getSingleFieldModeTemplate=function($field,fieldType,template){var eligibleFieldsSingleFieldMode=["name","address","gvtime","checklist"],formId=$field.data("formid"),fieldId=$field.data("fieldid"),inputNumber=$field.data("inputid");if(-1===$.inArray(fieldType,eligibleFieldsSingleFieldMode)||""===inputNumber)return!1;inputNumber*=1;var singleFieldModeTpl="",disableField=!1;switch(fieldType){case"name":2===inputNumber&&(singleFieldModeTpl+='<span class="gv-inline-edit-single-field-mode" data-inputnumber="'+inputNumber+'">'+gv_inline_x.templates[fieldType+"prefixes"]+"</span>");break;case"checklist":var single_checkbox_html=$(template).find("li,div").not(':has(input[name$=".'+inputNumber+'"])').remove().end().parents("div")[0].outerHTML;singleFieldModeTpl+='<div data-inputnumber="'+inputNumber+'">'+single_checkbox_html+"</div>";break;case"address":var hiddenFields=$field.data("hidden"),tplMode=$field.data("tplmode"),tplId=fieldType+tplMode+"_"+formId+"_"+fieldId;$.isArray(hiddenFields)&&$.each(hiddenFields,function(i,val){inputNumber==val&&(disableField=!0)}),4===inputNumber&&"international"!==tplMode&&gv_inline_x.templates.hasOwnProperty(tplId)&&(singleFieldModeTpl+='<select class="gv-inline-edit-single-field-mode" data-inputnumber="'+inputNumber+'">'+gv_inline_x.templates[tplId]+"</select>"),6===inputNumber&&(singleFieldModeTpl+='<select class="gv-inline-edit-single-field-mode" data-inputnumber="'+inputNumber+'">'+gv_inline_x.templates[tplId]+"</select>");break;case"gvtime":3===inputNumber&&(singleFieldModeTpl+='<select class="gv-inline-edit-single-field-mode" data-inputnumber="'+inputNumber+'"><option value="am">AM</option><option value="pm">PM</option></select>')}return singleFieldModeTpl||(singleFieldModeTpl+='<input type="text" class="gv-inline-edit-single-field-mode" data-inputnumber="'+inputNumber+'"/>'),{tpl:"<div>"+singleFieldModeTpl+"</div>",inputNumber:inputNumber,disableField:disableField}},$.fn.editableform.Constructor.prototype.error=function(msg){var $group=this.$form.find(".control-group"),$block=this.$form.find(".editable-error-block");!1===msg?($group.removeClass($.fn.editableform.errorGroupClass),$block.removeClass($.fn.editableform.errorBlockClass).empty().hide()):($group.addClass($.fn.editableform.errorGroupClass),$block.addClass($.fn.editableform.errorBlockClass).html(msg).show())},self.setInlineEditableInitialState=function(){$(".gv-inline-editable-view").each(function(){if(!$.cookie)return console&&console.info("jQuery Cookie not available; setting initial state to enabled."),void self.setEditableState($(this),"enabled",!1);var view_id=$(this).find(".gravityview-inline-edit-id").val();if(void 0===view_id)return void(console&&console.error("View ID is undefined when setting initial state."));var stored_state=$.cookie("gv-inline-edit-"+view_id);self.setEditableState($(this),stored_state,!1)})},self.setEditableState=function($views,state,set_cookie){if($views.find(".gv-inline-editable-disabled").toggleClass("editable-disabled","enabled"===state),state&&"enabled"===state?($views.removeClass("gv-inline-edit-off").addClass("gv-inline-edit-on"),$views.find("[class^=gv-inline-editable-field]").editable("enable"),gv_inline_x.showinputs&&("1"===gv_inline_x.showinputs&&(gv_inline_x.showinputs="[class^=gv-inline-editable-field]"),$views.find(gv_inline_x.showinputs).editable("show"))):($views.removeClass("gv-inline-edit-on").addClass("gv-inline-edit-off"),$views.find("[class^=gv-inline-editable-field]").editable("disable")),$views.find(".inline-edit-enable").text(function(){return $(this).attr("data-label-"+state)}),set_cookie&&$.cookie){var view_id=$views.find(".gravityview-inline-edit-id").val();$.cookie("gv-inline-edit-"+view_id,state,{domain:gv_inline_x.cookie_domain,path:gv_inline_x.cookiepath})}else set_cookie&&!$.cookie&&console&&console.error("jQuery Cookie script not loaded");$(document).trigger("gravityview-inline-edit/set-state",{state:state,views:$views})},self.toggleInlineEdit=function(){$(".inline-edit-enable").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var $view=$(this).parents(".gv-inline-editable-view"),$editable=$view.find("[class^=gv-inline-editable-field]");if(!$editable.length)return void alert(gv_inline_x.nofieldstext);var enabled_state;$editable.data("editable").options.disabled?($editable.editable("enable"),enabled_state="enabled"):($editable.editable("disable"),enabled_state="disabled"),self.setEditableState($view,enabled_state,!0)})},self.initColumnToggle=function(){$(".wp-admin .gf_entries, .gv-table-view").find("thead th, tfoot th").on("click",function(e){if(!$(this).parents(".gv-inline-edit-on").length)return!0;if($(this).is("#column_selector"))return!0;e.preventDefault(),$(this).toggleClass("gv-inline-edit-column-on");var regex_search=$("body").hasClass("wp-admin")?/column-field_id-/:/gv-field-/,class_list=$(this).attr("class").split(/\s+/),css_class_name=!1;if($.each(class_list,function(index,column_class_name){if(column_class_name.match(regex_search))return css_class_name=column_class_name,!1}),!css_class_name)return!1;var is_column_on=$(this).hasClass("gv-inline-edit-column-on"),$editables=$(this).parents("table").find('td[class~="'+css_class_name+'"]').find("[class^=gv-inline-editable-field]");return $editables.editable("option","showbuttons",gv_inline_x.showbuttons).editable("option","mode",is_column_on?"inline":gv_inline_x.mode).editable("option","onblur",is_column_on?"ignore":gv_inline_x.onblur),$("html, body").css({overflow:"hidden",height:"100%"}),is_column_on&&$editables.editable("show"),$(":focus").blur(),$("html, body").css({overflow:"auto",height:"auto"}),!1})},self.gfMoveToggleButton=function(){$(".wp-admin .inline-edit-enable").insertAfter(".tablenav.top .bulkactions").removeClass("hidden")},self.preventClicks=function(){$(".gv-inline-editable-disabled a").on("click",function(e){return!$(this).parents(".editable-disabled").length||(e.preventDefault(),!1)})},$(window).on("gravityview-inline-edit/extend-template-data",function(e,data){window.gv_inline_x.templates=$.extend({},window.gv_inline_x.templates,data)}),$(window).on("gravityview-inline-edit/init",function(){$(self.init)}),$(window).on("gravityview-datatables/event/responsive",self.init),+gv_inline_x.disableInitOnLoad||$(self.init)})}(jQuery);